{{#section "title"}}Quên mật khẩu - {{/section}}

<div class="card mx-auto" style="max-width: 800px;">
  <div class="card-header text-warning">
    <h5 class="mb-0">Quên mật khẩu</h5>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-12">
        <form method="POST" id="frmForgotPassword" action="/quenmatkhau">
          <div class="form-group">
            <label for="txtPhoneNumber">Số điện thoại</label>
            <input
              type="text"
              class="form-control"
              id="txtPhoneNumber"
              name="phone"
              placeholder="Nhập số điện thoại"
              required
            />
          </div>
          <div class="form-group">
            <label for="txtNewPassword">Mật khẩu mới</label>
            <input
              type="password"
              class="form-control"
              id="txtNewPassword"
              name="new_password"
              placeholder="Nhập mật khẩu mới"
              required
            />
          </div>
          <div class="form-group text-right">
            <button type="submit" class="btn btn-warning">
              <i class="fas fa-key"></i>
              Đặt lại mật khẩu
            </button>
          </div>
          <div class="form-group text-right">
            <span class="text-info">Đã nhớ mật khẩu? </span>
            <a href="/dangnhap">Đăng nhập</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Thêm script xử lý sự kiện -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('frmForgotPassword');

    form.addEventListener('submit', function(e) {
      e.preventDefault(); // Ngừng hành động submit mặc định

      const phone = document.getElementById('txtPhoneNumber').value;
      const newPassword = document.getElementById('txtNewPassword').value;

      console.log('Số điện thoại:', phone);  // Kiểm tra số điện thoại
      console.log('Mật khẩu mới:', newPassword); // Kiểm tra mật khẩu mới

      // Gửi dữ liệu bằng fetch
      fetch('/quenmatkhau', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',  // Hoặc 'application/json' nếu bạn muốn sử dụng JSON
        },
        body: new URLSearchParams({
          phone: phone,
          new_password: newPassword
        })
      })
      .then(response => response.json()) // Xử lý phản hồi từ server
      .then(data => {
        // Xử lý dữ liệu phản hồi từ server (ví dụ: thông báo thành công hoặc lỗi)
        if (data.success) {
          alert('Mật khẩu đã được đặt lại thành công!');
          window.location.href = '/dangnhap'; // Chuyển hướng tới trang đăng nhập
        } else {
          alert('Có lỗi xảy ra, vui lòng thử lại!');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Có lỗi xảy ra, vui lòng thử lại!');
      });
    });
  });
</script>